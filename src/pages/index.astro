---
import Layout from "@src/components/Layout.astro";
import Dump from "@src/components/Dump.astro";

import {getArtistsForEvent} from "@src/utils/ra";

let artists;
if (Astro.request.method === "POST") {
const formData = await Astro.request.formData();
const eventUrl = formData.get("event-url");
artists = await getArtistsForEvent(eventUrl);
}
---

<Layout>
	<h1>Hello world</h1>
  <p>Enter an RA event URL to start</p>
  <form method="POST">
    <label>Event URL
    <input type="text" name="event-url" />
    </label>
    <button>Submit</button>
  </form>

  <h2>Search results</h2>

  <ul>
    {artists.map(artist => (
    <li><a href={artist.url}>{artist.name}</a>
    <form action="/soundcloud/search/">
      <button name="q" value={artist.name}>Search on Soundcloud</button>
    </form>
    </li>
    ))}

  <Dump data={artists} />

</Layout>
